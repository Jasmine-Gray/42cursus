# 開発の歴史

## プロジェクトの始まり

Minishellプロジェクトは、42 Schoolのカリキュラムの一環として開始されました。単純なコマンドインタープリターから始まり、段階的に機能を追加していく反復的な開発アプローチを採用しています。

## 開発フェーズ

### Phase 1: 基礎構築 🏗️
**期間**: プロジェクト初期

**目標**: 最小限動作するシェルの実装

**実装内容**:
- 基本的なREPL（Read-Eval-Print Loop）
- 単純なコマンド実行
- プロセスのfork/exec処理

**学んだこと**:
- プロセス管理の基礎
- システムコールの使い方
- 標準入出力の扱い

---

### Phase 2: レクサー・パーサー実装 📝
**期間**: 初期〜中期

**目標**: コマンドライン入力を正しく解析

**実装内容**:
- トークン化処理（Lexer）
- 構文解析（Parser）
- AST（抽象構文木）の構築

**主要コミット**:
- 字句解析の実装
- パーサーによるコマンド分解
- クォート処理の追加

**課題と解決**:
- 問題: 複雑な入力（クォート、特殊文字）の処理
- 解決: 状態機械を使った字句解析

---

### Phase 3: パイプとリダイレクション 🔄
**期間**: 中期

**目標**: UNIXシェルの中核機能の実装

**実装内容**:
- パイプ処理（`|`）
- 入出力リダイレクション（`<`, `>`, `>>`）
- ファイルディスクリプタの管理

**技術的挑戦**:
- 複数のパイプを繋げる処理
- ファイルディスクリプタのリークを防ぐ
- 子プロセス間の通信

---

### Phase 4: ビルトインコマンド 🛠️
**期間**: 中期〜後期

**実装したコマンド**:
1. **echo** - テキスト出力
2. **cd** - ディレクトリ移動
3. **pwd** - カレントディレクトリ表示
4. **export** - 環境変数設定
5. **unset** - 環境変数削除
6. **env** - 環境変数一覧
7. **exit** - シェル終了

**PR履歴**:
- PR #22: `exit`コマンドの実装
- PR #20: 変数展開機能の追加

---

### Phase 5: エラーハンドリングとエッジケース 🛡️
**期間**: 後期

**目標**: 堅牢性の向上

**実装内容**:
- コマンドが見つからない場合のエラー処理（PR #23）
- シグナルハンドリング
- メモリリーク対策
- 終了ステータスの管理

**PR履歴**:
- PR #24: Norm準拠とエラー修正
- PR #25: exitエラー処理の改善

---

### Phase 6: テストと品質向上 ✅
**期間**: 継続中

**目標**: bashとの互換性確保

**実装内容**:
- 包括的なテストスイート作成
- bashとの動作比較
- バグの特定と修正

**成果**:
- 49個の動作確認テスト（100%合格）
- 39個の既知の問題を特定
- GitHub Issuesでの体系的な管理

---

## 技術的な進化

### 初期設計
```
入力 → 単純な分割 → 実行
```

### 現在の設計
```
入力 → Lexer → Parser → AST → Expander → Executor
     ↓         ↓         ↓         ↓          ↓
   トークン   構文木   抽象化   変数展開   実行管理
```

## 主要な技術的決定

1. **AST（抽象構文木）の採用**
   - 理由: 複雑なコマンド構造を効率的に表現
   - 効果: パイプやリダイレクションの処理が明確に

2. **状態機械による字句解析**
   - 理由: クォートや特殊文字の処理を正確に
   - 効果: エッジケースの削減

3. **ビルトインとexternal commandの分離**
   - 理由: 実行効率とプロセス管理の簡略化
   - 効果: cdやexportが正しく動作

## 学んだ教訓

### 成功したアプローチ
- **段階的な実装**: 基本機能から徐々に拡張
- **テスト駆動**: bashとの比較による検証
- **PR駆動開発**: 機能ごとにPRを作成し、レビュー

### 改善点
- **初期設計の見直し**: 後から大きな構造変更が必要に
- **エラーハンドリング**: 最初から組み込むべきだった
- **ドキュメント**: 開発と並行して記述すべきだった

## 今後の展望

### 短期目標
- シグナルハンドリングの修正（Issue #31, #32）
- 変数展開のバグ修正
- ヒアドキュメントの完全実装

### 長期目標
- より多くのbash機能との互換性
- パフォーマンスの最適化
- コードのリファクタリング

## 統計

- **総コミット数**: 100+
- **PR数**: 25+
- **解決した問題**: 多数
- **テストケース**: 88個（動作確認49個、TODO 39個）
- **コード行数**: 約3000行

## 振り返り

このプロジェクトを通じて、OSの内部動作、プロセス管理、システムプログラミングの深い理解を得ることができました。単純に見えるシェルコマンドの裏側には、複雑な処理とエラーハンドリングが必要であることを学びました。

特に印象的だったのは、「完璧を目指すより、まず動くものを作る」という反復的開発の重要性です。基本機能から始めて、徐々に機能を追加し、テストを通じて品質を向上させるアプローチが、大規模プロジェクトの成功の鍵となりました。